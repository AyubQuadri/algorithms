<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Polynom interpolation</title>
        <!--<script type="text/x-mathjax-config">
          MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
        </script>
        <script type="text/javascript"
          src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        </script>-->
        <!-- Piwik -->
        <script type="text/javascript">
          var _paq = _paq || [];
          _paq.push(['trackPageView']);
          _paq.push(['enableLinkTracking']);
          (function() {
            var u=(("https:" == document.location.protocol) ? "https" : "http") + "://martin-thoma.com/piwik//";
            _paq.push(['setTrackerUrl', u+'piwik.php']);
            _paq.push(['setSiteId', 1]);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
            g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
          })();
        </script>
        <!-- End Piwik Code -->
        <style type="text/css">
            span.hint {
	            border-bottom:1px dotted #666;
            }
        </style>
    </head>
    <body>
        <span id="polynomial">$p(x) = x^5$</span>
        <br/>
        <canvas id = "myCanvas"
                width = "512" height = "600" 
                style = "border:1px solid #000;"
        > </canvas>
        <textarea id="pointlist" style="width:256px"></textarea>
    <script type="text/javascript">
        function setCursorByID(id,cursorStyle) {
            var elem;
            if (document.getElementById &&
            (elem=document.getElementById(id)) ) {
                if (elem.style) elem.style.cursor=cursorStyle;
            }
        }
        

        /* calculate coordinates */
        function c(x,isX) {
            if(isX) {
                return x+xOffset;    
            } else {
                return -x+yOffset;
            }
        }

        function drawBoard(canvas) {
            var context = canvas.getContext('2d');
            context.canvas.width  = window.innerWidth - 50;
            context.canvas.height = window.innerHeight - 120;
            context.clearRect(0, 0, canvas.width, canvas.height);

            // x-axis
            context.beginPath();
            context.moveTo(c(xMin,true),c(0));
            context.lineTo(c(xMax,true),c(0));
            context.closePath();
            context.stroke();

            // y-axis
            context.beginPath();
            context.moveTo(c(0,true),c(yMin));
            context.lineTo(c(0,true),c(yMax));
            context.closePath();
            context.stroke();

            // x-ticks
            for (var x=xMin;x<xMax;x++){
                if (x % 10 == 0) {
                    context.beginPath();
                    context.moveTo(c(x,true),c(-5));
                    context.lineTo(c(x,true),c(5));
                    context.closePath();
                    context.stroke();
                }
            }

            // y-ticks
            for (var y=yMin;y<yMax;y++){
                if (y % 10 == 0) {
                    context.beginPath();
                    context.moveTo(c(-5,true),c(y));
                    context.lineTo(c(+5,true),c(y));
                    context.closePath();
                    context.stroke();
                }
            }

            // arrow x
            context.beginPath();
            context.moveTo(c(xMax-5,true),c(-7));
            context.lineTo(c(xMax,true),c(0));
            context.lineTo(c(xMax-5,true),c(+7));
            context.stroke();

            // arrow y
            context.beginPath();
            context.moveTo(c(-7,true),c(yMax-5));
            context.lineTo(c(+0,true),c(yMax));
            context.lineTo(c(+7,true),c(yMax-5));
            context.stroke();

            drawPoints(canvas);
            writePointList();
            drawPolynomial(canvas, {0:0,1:0, 2:1});
        }

        function drawPolynomial(canvas, polynomial) {
            var context = canvas.getContext('2d');
            context.beginPath();
            context.strokeStyle = 'blue';
            for (var x=xMin;x<xMax;x++){
                var y=0;
                for (var power in polynomial) {
                    y += polynomial[power] * Math.pow(x,power);
                }
                if (x==xMin) {
                    context.moveTo(c(x,true),c(y,false));
                } else {
                    context.lineTo(c(x,true),c(y,false));
                }
            }
            context.closePath();
            context.stroke();

            var mathEl = document.getElementById("polynomial");
            mathEl.innerHTML = '$p(x) = ';
            for (var power in polynomial) {
                mathEl.innerHTML += '+x^' + power + ' ';
            }
            mathEl.innerHTML+= '$';
        }

        /** permanently add a point */
        function addPoint(event, canvas, mouseCoords, radius) {
            points.push({"x": parseInt(mouseCoords["x"]),
                         "y": parseInt(mouseCoords["y"])});
        }

        /** draw all permanently added points */
        function drawPoints(canvas) {
            for(var i = 0; i < points.length; i++) {
                context.beginPath();
                context.arc(points[i]["x"], 
                            points[i]["y"], 
                            2, /*radius*/
                            0, 2 * Math.PI, false);
                context.lineWidth = 1;
                context.strokeStyle = 'black';
                context.fillStyle = "rgb(0,0,0)";
                context.fill();
                context.stroke();
            }
        }

        function writePointList() {
            var tArea = document.getElementById("pointlist");
            tArea.value = '';
            for(var i = 0; i < points.length; i++) {
                tArea.value += "(" + points[i]["x"] + "|" + points[i]["y"] + "), ";
            }
        }
      
        /** get the current position of the mouse */
        function getMouseCoords(canvas, evt) {
            var rect = canvas.getBoundingClientRect();
            return {
                "x": evt.clientX - rect.left,
                "y": evt.clientY - rect.top
            };
        }
      
        /** global variables */
        var xMin = -200;
        var xMax = +200;
        var yMin = -150;
        var yMax = +150;
        var xOffset = 256;
        var yOffset = 200;
        var points = new Array();
        var canvas = document.getElementById("myCanvas");
        var context = canvas.getContext("2d");
        drawBoard(canvas, {"x":0,"y":0}, 10);
        setCursorByID("myCanvas", "crosshair");

        /** event listeners */
        canvas.addEventListener('mousemove', 
            function(evt) {
                var mouseCoords = getMouseCoords(canvas, evt);
                drawBoard(canvas, mouseCoords, 10);
            }, false);

        canvas.addEventListener("mousedown", 
            function(event) {
                var mouseCoords = getMouseCoords(canvas, event);
                addPoint(event, canvas, mouseCoords, 10);
            }, false);
    </script>
</body>
</html>
